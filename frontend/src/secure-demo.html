<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ë³´ì•ˆ í†µì‹  ë°ëª¨ - JSON ìë™ ì•”í˜¸í™”/ë³µí˜¸í™”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 40px;
            font-weight: 600;
            text-align: center;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .status.ready {
            background: #d1edff;
            color: #004085;
            border: 2px solid #bee5eb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .content {
            padding: 40px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .demo-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #007bff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .demo-section h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 123, 255, 0.3);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        .btn.warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }

        .btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            margin-top: 15px;
        }

        .info-panel {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .info-panel h3 {
            color: #1565c0;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2rem;
            }
            .content {
                padding: 20px;
            }
        }

        .json-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .encryption-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }

        .encryption-indicator.encrypted {
            background: #d4edda;
            color: #155724;
        }

        .encryption-indicator.plain {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ë³´ì•ˆ í†µì‹  ë°ëª¨</h1>
            <p>JSON ìë™ ì•”í˜¸í™”/ë³µí˜¸í™” ì‹œìŠ¤í…œ</p>
            <p>ëª¨ë“  ë³´ì•ˆ API í˜¸ì¶œì€ ìë™ìœ¼ë¡œ ì•”í˜¸í™”ë˜ì–´ ì „ì†¡ë©ë‹ˆë‹¤</p>
        </div>

        <div id="status" class="status loading">
            ğŸ”„ WebAssembly ì•”í˜¸í™” ëª¨ë“ˆì„ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
        </div>

        <div class="content">
            <div class="info-panel">
                <h3>ğŸ”§ ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                <div id="system-info">
                    <p><strong>ì•”í˜¸í™” ëª¨ë“ˆ:</strong> <span id="crypto-status">ëŒ€ê¸°ì¤‘</span></p>
                    <p><strong>ì„œë²„ ì—°ê²°:</strong> <span id="server-status">í™•ì¸ì¤‘</span></p>
                    <p><strong>ì•”í˜¸í™” ë°©ì‹:</strong> AES-256-GCM</p>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="user-operations">0</div>
                        <div class="stat-label">ì‚¬ìš©ì ì‘ì—…</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="data-operations">0</div>
                        <div class="stat-label">ë°ì´í„° ì‘ì—…</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="message-operations">0</div>
                        <div class="stat-label">ë©”ì‹œì§€ ì‘ì—…</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-encrypted">0</div>
                        <div class="stat-label">ì´ ì•”í˜¸í™” íšŸìˆ˜</div>
                    </div>
                </div>
            </div>

            <div class="demo-grid">
                <!-- ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ -->
                <div class="demo-section">
                    <h2>ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬ <span class="encryption-indicator encrypted">ì•”í˜¸í™”ë¨</span></h2>
                    
                    <div class="input-group">
                        <label>ì‚¬ìš©ìëª…:</label>
                        <input type="text" id="username" placeholder="ì‚¬ìš©ìëª… ì…ë ¥" value="testuser">
                    </div>
                    
                    <div class="input-group">
                        <label>ì´ë©”ì¼:</label>
                        <input type="email" id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" value="test@example.com">
                    </div>
                    
                    <div class="input-group">
                        <label>ë¹„ë°€ë²ˆí˜¸:</label>
                        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" value="password123">
                    </div>
                    
                    <div class="input-group">
                        <label>í”„ë¡œí•„ ì •ë³´ (JSON):</label>
                        <textarea id="profile" rows="3" placeholder='{"name": "í™ê¸¸ë™", "age": 30}'>{
  "name": "í™ê¸¸ë™",
  "age": 30,
  "department": "ê°œë°œíŒ€"
}</textarea>
                    </div>
                    
                    <button class="btn success" onclick="registerUser()">ì‚¬ìš©ì ë“±ë¡</button>
                    <button class="btn" onclick="loginUser()">ë¡œê·¸ì¸</button>
                    <button class="btn warning" onclick="clearUserForm()">í¼ ì´ˆê¸°í™”</button>
                    
                    <div id="user-output" class="output">
ì‚¬ìš©ì ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>

                <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
                <div class="demo-section">
                    <h2>ğŸ“ ë°ì´í„° ê´€ë¦¬ <span class="encryption-indicator encrypted">ì•”í˜¸í™”ë¨</span></h2>
                    
                    <div class="input-group">
                        <label>ë°ì´í„° íƒ€ì…:</label>
                        <select id="data-type">
                            <option value="document">ë¬¸ì„œ</option>
                            <option value="image">ì´ë¯¸ì§€</option>
                            <option value="config">ì„¤ì •</option>
                            <option value="report">ë³´ê³ ì„œ</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>ë°ì´í„° ë‚´ìš© (JSON):</label>
                        <textarea id="data-content" rows="4" placeholder='{"title": "ì œëª©", "body": "ë‚´ìš©"}'>{
  "title": "ì¤‘ìš”í•œ ë¬¸ì„œ",
  "body": "ì´ê²ƒì€ ê¸°ë°€ ì •ë³´ì…ë‹ˆë‹¤.",
  "tags": ["ì¤‘ìš”", "ê¸°ë°€"],
  "author": "system"
}</textarea>
                    </div>
                    
                    <div class="input-group">
                        <label>ë©”íƒ€ë°ì´í„° (JSON):</label>
                        <textarea id="metadata" rows="3" placeholder='{"version": "1.0"}'>{
  "version": "1.0",
  "classification": "confidential",
  "department": "security"
}</textarea>
                    </div>
                    
                    <button class="btn success" onclick="createData()">ë°ì´í„° ìƒì„±</button>
                    <button class="btn" onclick="readData()">ë°ì´í„° ì¡°íšŒ</button>
                    <button class="btn warning" onclick="clearDataForm()">í¼ ì´ˆê¸°í™”</button>
                    
                    <div id="data-output" class="output">
ë°ì´í„° ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>

                <!-- ë©”ì‹œì§€ ì „ì†¡ ì„¹ì…˜ -->
                <div class="demo-section">
                    <h2>ğŸ“¨ ë©”ì‹œì§€ ì „ì†¡ <span class="encryption-indicator encrypted">ì•”í˜¸í™”ë¨</span></h2>
                    
                    <div class="input-group">
                        <label>ìˆ˜ì‹ ì:</label>
                        <input type="text" id="recipient" placeholder="ìˆ˜ì‹ ì ID" value="admin">
                    </div>
                    
                    <div class="input-group">
                        <label>ì œëª©:</label>
                        <input type="text" id="subject" placeholder="ë©”ì‹œì§€ ì œëª©" value="ê¸´ê¸‰ ë³´ê³ ">
                    </div>
                    
                    <div class="input-group">
                        <label>ìš°ì„ ìˆœìœ„:</label>
                        <select id="priority">
                            <option value="low">ë‚®ìŒ</option>
                            <option value="normal" selected>ë³´í†µ</option>
                            <option value="high">ë†’ìŒ</option>
                            <option value="urgent">ê¸´ê¸‰</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>ë©”ì‹œì§€ ë‚´ìš©:</label>
                        <textarea id="message-content" rows="4" placeholder="ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">ì•ˆë…•í•˜ì„¸ìš”,

ì´ê²ƒì€ ì•”í˜¸í™”ëœ í†µì‹ ìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ê¸°ë°€ ë©”ì‹œì§€ì…ë‹ˆë‹¤.
ëª¨ë“  ë‚´ìš©ì€ AES-256-GCMìœ¼ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.</textarea>
                    </div>
                    
                    <button class="btn success" onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
                    <button class="btn warning" onclick="clearMessageForm()">í¼ ì´ˆê¸°í™”</button>
                    
                    <div id="message-output" class="output">
ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>

                <!-- JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
                <div class="demo-section">
                    <h2>ğŸ” JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ <span class="encryption-indicator plain">í…ŒìŠ¤íŠ¸ìš©</span></h2>
                    
                    <div class="input-group">
                        <label>í…ŒìŠ¤íŠ¸ JSON ë°ì´í„°:</label>
                        <textarea id="test-json" rows="4" placeholder='{"test": "data"}'>{
  "message": "Hello World!",
  "korean": "ì•ˆë…•í•˜ì„¸ìš”!",
  "numbers": [1, 2, 3, 4, 5],
  "nested": {
    "info": "ì¤‘ì²©ëœ ê°ì²´",
    "timestamp": "2024-01-01T00:00:00Z"
  }
}</textarea>
                    </div>
                    
                    <button class="btn" onclick="testJSONEncryption()">JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸</button>
                    <button class="btn" onclick="testServerEncryption()">ì„œë²„ ì•”í˜¸í™” í…ŒìŠ¤íŠ¸</button>
                    <button class="btn warning" onclick="clearTestForm()">í¼ ì´ˆê¸°í™”</button>
                    
                    <div id="test-output" class="output">
JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>

                <!-- ì‹œìŠ¤í…œ ì§„ë‹¨ ì„¹ì…˜ -->
                <div class="demo-section">
                    <h2>ğŸ”§ ì‹œìŠ¤í…œ ì§„ë‹¨ <span class="encryption-indicator plain">ì§„ë‹¨ìš©</span></h2>
                    
                    <button class="btn" onclick="checkServerHealth()">ì„œë²„ ìƒíƒœ í™•ì¸</button>
                    <button class="btn" onclick="getCryptoInfo()">ì•”í˜¸í™” ì •ë³´</button>
                    <button class="btn danger" onclick="clearAllOutputs()">ëª¨ë“  ì¶œë ¥ ì´ˆê¸°í™”</button>
                    
                    <div class="json-preview" id="system-details">
ì‹œìŠ¤í…œ ì§„ë‹¨ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                    
                    <div id="diagnostic-output" class="output">
ì§„ë‹¨ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- WebAssembly ë° ì•”í˜¸í™” ìœ í‹¸ë¦¬í‹° ë¡œë“œ -->
    <script src="wasm_exec.js"></script>
    <script src="crypto-utils.js"></script>
    
    <script>
        // í†µê³„ ë³€ìˆ˜
        let stats = {
            userOperations: 0,
            dataOperations: 0,
            messageOperations: 0,
            totalEncrypted: 0
        };

        // WebAssembly ë¡œë“œ
        let wasmReady = false;

        async function loadWebAssembly() {
            try {
                updateStatus("loading", "ğŸ”„ WebAssembly ëª¨ë“ˆì„ ë¡œë“œí•˜ëŠ” ì¤‘...");
                
                const go = new Go();
                const result = await WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject);
                go.run(result.instance);
                
                console.log("âœ… WebAssembly ë¡œë“œ ì™„ë£Œ");
            } catch (error) {
                console.error("âŒ WebAssembly ë¡œë“œ ì‹¤íŒ¨:", error);
                updateStatus("error", "âŒ WebAssembly ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message);
            }
        }

        // WebAssembly ì¤€ë¹„ ì™„ë£Œ ì½œë°±
        window.onCryptoWasmReady = function() {
            wasmReady = true;
            updateStatus("ready", "âœ… ì•”í˜¸í™” ëª¨ë“ˆì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!");
            document.getElementById('crypto-status').textContent = 'ì¤€ë¹„ë¨ âœ…';
            checkServerHealth();
        };

        function updateStatus(type, message) {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
        }

        function updateStats() {
            document.getElementById('user-operations').textContent = stats.userOperations;
            document.getElementById('data-operations').textContent = stats.dataOperations;
            document.getElementById('message-operations').textContent = stats.messageOperations;
            document.getElementById('total-encrypted').textContent = stats.totalEncrypted;
        }

        // ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤
        async function registerUser() {
            if (!wasmReady) {
                alert("WebAssemblyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                let profile = {};
                try {
                    profile = JSON.parse(document.getElementById('profile').value);
                } catch (e) {
                    profile = { note: document.getElementById('profile').value };
                }

                const userData = {
                    username: document.getElementById('username').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    profile: profile
                };

                document.getElementById('user-output').textContent = "ğŸ”„ ì‚¬ìš©ì ë“±ë¡ ì¤‘...";
                
                const result = await cryptoUtils.registerUser(userData);
                
                if (result.success) {
                    document.getElementById('user-output').textContent = 
                        `âœ… ì‚¬ìš©ì ë“±ë¡ ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}\n\nì•”í˜¸í™”: ${result.encrypted}\nì‹œê°„: ${result.timestamp}`;
                    stats.userOperations++;
                    stats.totalEncrypted++;
                } else {
                    document.getElementById('user-output').textContent = 
                        `âŒ ì‚¬ìš©ì ë“±ë¡ ì‹¤íŒ¨:\n${result.error || JSON.stringify(result.data, null, 2)}`;
                }
                
                updateStats();
            } catch (error) {
                document.getElementById('user-output').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }

        async function loginUser() {
            if (!wasmReady) {
                alert("WebAssemblyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                const credentials = {
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                };

                document.getElementById('user-output').textContent = "ğŸ”„ ë¡œê·¸ì¸ ì¤‘...";
                
                const result = await cryptoUtils.loginUser(credentials);
                
                if (result.success) {
                    document.getElementById('user-output').textContent = 
                        `âœ… ë¡œê·¸ì¸ ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}\n\nì•”í˜¸í™”: ${result.encrypted}\nì‹œê°„: ${result.timestamp}`;
                    stats.userOperations++;
                    stats.totalEncrypted++;
                } else {
                    document.getElementById('user-output').textContent = 
                        `âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:\n${result.error || JSON.stringify(result.data, null, 2)}`;
                }
                
                updateStats();
            } catch (error) {
                document.getElementById('user-output').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }

        // ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ë“¤
        async function createData() {
            if (!wasmReady) {
                alert("WebAssemblyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                let content = {};
                let metadata = {};
                
                try {
                    content = JSON.parse(document.getElementById('data-content').value);
                } catch (e) {
                    content = { text: document.getElementById('data-content').value };
                }
                
                try {
                    metadata = JSON.parse(document.getElementById('metadata').value);
                } catch (e) {
                    metadata = { note: document.getElementById('metadata').value };
                }

                const dataInfo = {
                    type: document.getElementById('data-type').value,
                    content: content,
                    metadata: metadata
                };

                document.getElementById('data-output').textContent = "ğŸ”„ ë°ì´í„° ìƒì„± ì¤‘...";
                
                const result = await cryptoUtils.createData(dataInfo);
                
                if (result.success) {
                    document.getElementById('data-output').textContent = 
                        `âœ… ë°ì´í„° ìƒì„± ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}\n\nì•”í˜¸í™”: ${result.encrypted}\nì‹œê°„: ${result.timestamp}`;
                    stats.dataOperations++;
                    stats.totalEncrypted++;
                } else {
                    document.getElementById('data-output').textContent = 
                        `âŒ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:\n${result.error || JSON.stringify(result.data, null, 2)}`;
                }
                
                updateStats();
            } catch (error) {
                document.getElementById('data-output').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }

        async function readData() {
            if (!wasmReady) {
                alert("WebAssemblyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                const queryInfo = {
                    type: document.getElementById('data-type').value,
                    filters: { classification: 'confidential' }
                };

                document.getElementById('data-output').textContent = "ğŸ”„ ë°ì´í„° ì¡°íšŒ ì¤‘...";
                
                const result = await cryptoUtils.readData(queryInfo);
                
                if (result.success) {
                    document.getElementById('data-output').textContent = 
                        `âœ… ë°ì´í„° ì¡°íšŒ ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}\n\nì•”í˜¸í™”: ${result.encrypted}\nì‹œê°„: ${result.timestamp}`;
                    stats.dataOperations++;
                    stats.totalEncrypted++;
                } else {
                    document.getElementById('data-output').textContent = 
                        `âŒ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:\n${result.error || JSON.stringify(result.data, null, 2)}`;
                }
                
                updateStats();
            } catch (error) {
                document.getElementById('data-output').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
        async function sendMessage() {
            if (!wasmReady) {
                alert("WebAssemblyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                const messageInfo = {
                    recipient: document.getElementById('recipient').value,
                    subject: document.getElementById('subject').value,
                    content: document.getElementById('message-content').value,
                    priority: document.getElementById('priority').value
                };

                document.getElementById('message-output').textContent = "ğŸ”„ ë©”ì‹œì§€ ì „ì†¡ ì¤‘...";
                
                const result = await cryptoUtils.sendMessage(messageInfo);
                
                if (result.success) {
                    document.getElementById('message-output').textContent = 
                        `âœ… ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ!\n\n${JSON.stringify(result.data, null, 2)}\n\nì•”í˜¸í™”: ${result.encrypted}\nì‹œê°„: ${result.timestamp}`;
                    stats.messageOperations++;
                    stats.totalEncrypted++;
                } else {
                    document.getElementById('message-output').textContent = 
                        `âŒ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:\n${result.error || JSON.stringify(result.data, null, 2)}`;
                }
                
                updateStats();
            } catch (error) {
                document.getElementById('message-output').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }

        // JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testJSONEncryption() {
            if (!wasmReady) {
                alert("WebAssemblyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            try {
                const testData = JSON.parse(document.getElementById('test-json').value);
                
                document.getElementById('test-output').textContent = "ğŸ”„ JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ì¤‘...";
                
                // ì•”í˜¸í™”
                const encryptResult = cryptoUtils.encryptJSON(testData);
                if (!encryptResult.success) {
                    throw new Error("ì•”í˜¸í™” ì‹¤íŒ¨: " + encryptResult.error);
                }
                
                // ë³µí˜¸í™”
                const decryptResult = cryptoUtils.decryptJSON(encryptResult.encryptedData);
                if (!decryptResult.success) {
                    throw new Error("ë³µí˜¸í™” ì‹¤íŒ¨: " + decryptResult.error);
                }
                
                const isValid = JSON.stringify(testData) === JSON.stringify(decryptResult.data);
                
                document.getElementById('test-output').textContent = 
                    `${isValid ? 'âœ…' : 'âŒ'} JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ${isValid ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}!\n\n` +
                    `ì›ë³¸ ë°ì´í„°:\n${JSON.stringify(testData, null, 2)}\n\n` +
                    `ì•”í˜¸í™”ëœ ë°ì´í„°:\n${encryptResult.encryptedData.slice(0, 100)}...\n\n` +
                    `ë³µí˜¸í™”ëœ ë°ì´í„°:\n${JSON.stringify(decryptResult.data, null, 2)}\n\n` +
                    `ê²€ì¦ ê²°ê³¼: ${isValid ? 'ì¼ì¹˜' : 'ë¶ˆì¼ì¹˜'}`;
                
                if (isValid) {
                    stats.totalEncrypted++;
                    updateStats();
                }
            } catch (error) {
                document.getElementById('test-output').textContent = `âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
            }
        }

        async function testServerEncryption() {
            try {
                const testData = JSON.parse(document.getElementById('test-json').value);
                
                document.getElementById('test-output').textContent = "ğŸ”„ ì„œë²„ JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ì¤‘...";
                
                const result = await cryptoUtils.apiCall('/api/test-json-encryption', {
                    method: 'POST',
                    body: JSON.stringify({ testData })
                });
                
                document.getElementById('test-output').textContent = 
                    `âœ… ì„œë²„ ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n\n${JSON.stringify(result, null, 2)}`;
                
            } catch (error) {
                document.getElementById('test-output').textContent = `âŒ ì„œë²„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
            }
        }

        // ì‹œìŠ¤í…œ ì§„ë‹¨ í•¨ìˆ˜ë“¤
        async function checkServerHealth() {
            try {
                document.getElementById('server-status').textContent = 'í™•ì¸ì¤‘...';
                
                const result = await cryptoUtils.checkHealth();
                
                document.getElementById('diagnostic-output').textContent = 
                    `âœ… ì„œë²„ ìƒíƒœ í™•ì¸ ì™„ë£Œ!\n\n${JSON.stringify(result, null, 2)}`;
                
                document.getElementById('server-status').textContent = 'ì—°ê²°ë¨ âœ…';
                
                // ì‹œìŠ¤í…œ ì„¸ë¶€ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('system-details').textContent = JSON.stringify(result, null, 2);
                
            } catch (error) {
                document.getElementById('diagnostic-output').textContent = `âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`;
                document.getElementById('server-status').textContent = 'ì—°ê²° ì‹¤íŒ¨ âŒ';
            }
        }

        async function getCryptoInfo() {
            try {
                const result = await cryptoUtils.getCryptoInfo();
                
                document.getElementById('diagnostic-output').textContent = 
                    `âœ… ì•”í˜¸í™” ì •ë³´ ì¡°íšŒ ì™„ë£Œ!\n\n${JSON.stringify(result, null, 2)}`;
                
            } catch (error) {
                document.getElementById('diagnostic-output').textContent = `âŒ ì•”í˜¸í™” ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`;
            }
        }

        // í¼ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤
        function clearUserForm() {
            document.getElementById('username').value = 'testuser';
            document.getElementById('email').value = 'test@example.com';
            document.getElementById('password').value = 'password123';
            document.getElementById('profile').value = '{\n  "name": "í™ê¸¸ë™",\n  "age": 30,\n  "department": "ê°œë°œíŒ€"\n}';
            document.getElementById('user-output').textContent = 'ì‚¬ìš©ì ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
        }

        function clearDataForm() {
            document.getElementById('data-type').value = 'document';
            document.getElementById('data-content').value = '{\n  "title": "ì¤‘ìš”í•œ ë¬¸ì„œ",\n  "body": "ì´ê²ƒì€ ê¸°ë°€ ì •ë³´ì…ë‹ˆë‹¤.",\n  "tags": ["ì¤‘ìš”", "ê¸°ë°€"],\n  "author": "system"\n}';
            document.getElementById('metadata').value = '{\n  "version": "1.0",\n  "classification": "confidential",\n  "department": "security"\n}';
            document.getElementById('data-output').textContent = 'ë°ì´í„° ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
        }

        function clearMessageForm() {
            document.getElementById('recipient').value = 'admin';
            document.getElementById('subject').value = 'ê¸´ê¸‰ ë³´ê³ ';
            document.getElementById('priority').value = 'normal';
            document.getElementById('message-content').value = 'ì•ˆë…•í•˜ì„¸ìš”,\n\nì´ê²ƒì€ ì•”í˜¸í™”ëœ í†µì‹ ìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ê¸°ë°€ ë©”ì‹œì§€ì…ë‹ˆë‹¤.\nëª¨ë“  ë‚´ìš©ì€ AES-256-GCMìœ¼ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤.\n\nê°ì‚¬í•©ë‹ˆë‹¤.';
            document.getElementById('message-output').textContent = 'ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
        }

        function clearTestForm() {
            document.getElementById('test-json').value = '{\n  "message": "Hello World!",\n  "korean": "ì•ˆë…•í•˜ì„¸ìš”!",\n  "numbers": [1, 2, 3, 4, 5],\n  "nested": {\n    "info": "ì¤‘ì²©ëœ ê°ì²´",\n    "timestamp": "2024-01-01T00:00:00Z"\n  }\n}';
            document.getElementById('test-output').textContent = 'JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
        }

        function clearAllOutputs() {
            document.getElementById('user-output').textContent = 'ì‚¬ìš©ì ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('data-output').textContent = 'ë°ì´í„° ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('message-output').textContent = 'ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('test-output').textContent = 'JSON ì•”í˜¸í™” í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('diagnostic-output').textContent = 'ì§„ë‹¨ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('system-details').textContent = 'ì‹œìŠ¤í…œ ì§„ë‹¨ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            
            stats = {
                userOperations: 0,
                dataOperations: 0,
                messageOperations: 0,
                totalEncrypted: 0
            };
            updateStats();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            loadWebAssembly();
            updateStats();
        };
    </script>
</body>
</html> 